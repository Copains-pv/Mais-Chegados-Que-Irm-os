<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login / Cadastro - Copains</title>
    <!-- Importação do Tailwind CSS para estilos rápidos -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fontes do Google e Ícones (FontAwesome) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;0,700;1,700&display=swap"
      rel="stylesheet"
    />
    
    <style>
      body {
        font-family: "Montserrat", sans-serif;
      }
      /* Oculta formulários inativos */
      .form-container {
        display: none;
      }
      /* Exibe o formulário ativo */
      .form-container.active {
        display: block;
      }
      /* Cores de feedback */
      .message-success {
        color: #10b981; /* Verde */
      }
      .message-error {
        color: #ef4444; /* Vermelho */
      }
    </style>
  </head>
  <body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-md">
      
      <!-- ABAS DE NAVEGAÇÃO -->
      <div class="flex border-b mb-6">
        <button
          id="show-login"
          class="flex-1 py-2 text-center font-semibold border-b-2 border-red-500 text-red-500"
        >
          Login
        </button>
        <button
          id="show-register"
          class="flex-1 py-2 text-center font-semibold text-gray-500"
        >
          Cadastro
        </button>
      </div>

      <!-- FORMULÁRIO DE LOGIN -->
      <div id="login-form" class="form-container active">
        <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">
          Acesse sua Conta
        </h2>
        <form id="login">
          <div class="mb-4">
            <label for="login-email" class="block text-gray-700 font-bold mb-2">E-mail:</label>
            <input
              type="email"
              id="login-email"
              name="email"
              required
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-red-300"
            />
          </div>
          <div class="mb-6">
            <label for="login-password" class="block text-gray-700 font-bold mb-2">Senha:</label>
            <input
              type="password"
              id="login-password"
              name="password"
              required
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-red-300"
            />
          </div>
          <div class="text-right mb-6">
            <a href="#" id="show-forgot-password" class="text-sm text-red-500 hover:underline">Esqueceu a senha?</a>
          </div>
          <div class="text-center">
            <button
              type="submit"
              class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:shadow-outline w-full"
            >
              Entrar
            </button>
          </div>
          
          <!-- Divisor "OU" -->
          <div class="flex items-center my-6">
            <div class="flex-grow border-t border-gray-300"></div>
            <span class="mx-4 text-gray-500 font-semibold">OU</span>
            <div class="flex-grow border-t border-gray-300"></div>
          </div>
          
          <!-- Botão Google (Login) -->
          <div class="space-y-4">
            <button
              id="google-login-btn"
              type="button"
              class="w-full flex items-center justify-center bg-white border border-gray-300 text-gray-700 font-bold py-2 px-4 rounded-md hover:bg-gray-50 focus:outline-none focus:shadow-outline"
            >
              <i class="fab fa-google mr-2"></i>
              Entrar com Google
            </button>
          </div>
          
          <!-- Mensagens de feedback do Login -->
          <div id="login-message" class="mt-4 text-center font-semibold"></div>
        </form>
      </div>

      <!-- FORMULÁRIO DE CADASTRO -->
      <div id="register-form" class="form-container">
        <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">
          Crie sua Conta
        </h2>
        <form id="register">
          <div class="mb-4">
            <label for="register-name" class="block text-gray-700 font-bold mb-2">Nome:</label>
            <input
              type="text"
              id="register-name"
              name="name"
              required
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-red-300"
            />
          </div>
          <div class="mb-4">
            <label for="register-email" class="block text-gray-700 font-bold mb-2">E-mail:</label>
            <input
              type="email"
              id="register-email"
              name="email"
              required
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-red-300"
            />
          </div>
          <div class="mb-6">
            <label for="register-password" class="block text-gray-700 font-bold mb-2">Senha:</label>
            <input
              type="password"
              id="register-password"
              name="password"
              required
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-red-300"
            />
          </div>
          <div class="text-center">
            <button
              type="submit"
              class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:shadow-outline w-full"
            >
              Cadastrar
            </button>
          </div>
          
          <!-- Divisor "OU" -->
          <div class="flex items-center my-6">
            <div class="flex-grow border-t border-gray-300"></div>
            <span class="mx-4 text-gray-500 font-semibold">OU</span>
            <div class="flex-grow border-t border-gray-300"></div>
          </div>
          
          <!-- Botão Google (Cadastro) -->
          <div class="space-y-4">
            <button
              id="google-register-btn"
              type="button"
              class="w-full flex items-center justify-center bg-white border border-gray-300 text-gray-700 font-bold py-2 px-4 rounded-md hover:bg-gray-50 focus:outline-none focus:shadow-outline"
            >
              <i class="fab fa-google mr-2"></i>
              Cadastrar com Google
            </button>
          </div>
          
          <!-- Mensagens de feedback do Cadastro -->
          <div id="register-message" class="mt-4 text-center font-semibold"></div>
        </form>
      </div>

      <!-- FORMULÁRIO DE RECUPERAÇÃO DE SENHA -->
      <div id="forgot-password-form" class="form-container">
        <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">
          Recuperar Senha
        </h2>
        <p class="text-center text-gray-600 mb-6">
          Digite seu e-mail e enviaremos um link para redefinir sua senha.
        </p>
        <form id="forgot-password">
          <div class="mb-4">
            <label for="forgot-email" class="block text-gray-700 font-bold mb-2">E-mail:</label>
            <input
              type="email"
              id="forgot-email"
              name="email"
              required
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-red-300"
              placeholder="seu.email@exemplo.com"
            />
          </div>
          <div class="text-center">
            <button
              type="submit"
              class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:shadow-outline w-full"
            >
              Enviar E-mail de Recuperação
            </button>
          </div>
          <div id="forgot-message" class="mt-4 text-center font-semibold"></div>
          <div class="text-center mt-4">
            <a href="#" id="back-to-login" class="text-sm text-red-500 hover:underline">Voltar para o Login</a>
          </div>
        </form>
      </div>
    </div>

    <!-- SCRIPT 1: Lógica Local (Simulação de Banco de Dados com LocalStorage) -->
    <script>
      /**
       * Esta função é executada assim que todo o HTML é carregado.
       * Configura os botões de navegação entre abas e a lógica dos formulários.
       */
      document.addEventListener("DOMContentLoaded", () => {
        // Seleção dos elementos do DOM (Botões e Formulários)
        const showLoginBtn = document.getElementById("show-login");
        const showRegisterBtn = document.getElementById("show-register");
        const loginForm = document.getElementById("login-form");
        const registerForm = document.getElementById("register-form");
        const forgotPasswordForm = document.getElementById("forgot-password-form");
        const showForgotPasswordBtn = document.getElementById("show-forgot-password");
        const backToLoginBtn = document.getElementById("back-to-login");

        // Elementos de mensagem (feedback visual)
        const loginMessage = document.getElementById("login-message");
        const registerMessage = document.getElementById("register-message");
        const forgotMessage = document.getElementById("forgot-message");

        /**
         * Função auxiliar para alternar entre as telas (Login, Cadastro, Recuperação).
         * @param {HTMLElement} formToShow - O formulário que deve ficar visível.
         */
        function showForm(formToShow) {
          // Esconde todos os formulários removendo a classe 'active'
          [loginForm, registerForm, forgotPasswordForm].forEach((form) =>
            form.classList.remove("active")
          );
          // Mostra apenas o formulário desejado
          formToShow.classList.add("active");

          // Limpa mensagens de erro/sucesso anteriores
          loginMessage.textContent = "";
          registerMessage.textContent = "";
          forgotMessage.textContent = "";
          forgotMessage.classList.remove("message-success", "message-error");

          // Verifica qual formulário está ativo para estilizar a aba superior
          const isLogin = formToShow === loginForm;
          const isRegister = formToShow === registerForm;

          // Atualiza o estilo visual das abas (borda vermelha e cor do texto)
          showLoginBtn.classList.toggle("border-red-500", isLogin);
          showLoginBtn.classList.toggle("text-red-500", isLogin);
          showLoginBtn.classList.toggle("text-gray-500", !isLogin);

          showRegisterBtn.classList.toggle("border-red-500", isRegister);
          showRegisterBtn.classList.toggle("text-red-500", isRegister);
          showRegisterBtn.classList.toggle("text-gray-500", !isRegister);

          // Se estiver na tela de "Recuperar Senha", esconde as abas de navegação
          showLoginBtn.parentElement.style.display =
            formToShow === forgotPasswordForm ? "none" : "flex";
        }

        // --- Adiciona os ouvintes de clique nos botões de navegação ---
        showLoginBtn.addEventListener("click", () => showForm(loginForm));
        showRegisterBtn.addEventListener("click", () => showForm(registerForm));
        
        // Botão "Esqueceu a senha?" leva para o formulário de recuperação
        showForgotPasswordBtn.addEventListener("click", (e) => {
          e.preventDefault(); // Evita comportamento padrão do link
          showForm(forgotPasswordForm);
        });
        
        // Botão "Voltar para Login" retorna para o formulário de login
        backToLoginBtn.addEventListener("click", (e) => {
          e.preventDefault();
          showForm(loginForm);
        });

        // --- LÓGICA DE LOGIN (Usando LocalStorage) ---
        document.getElementById("login").addEventListener("submit", (e) => {
          e.preventDefault(); // Evita o recarregamento da página
          loginMessage.textContent = "";

          // Recupera os usuários salvos no navegador (ou cria lista vazia)
          const registeredUsers = JSON.parse(localStorage.getItem("registeredUsers")) || [];
          const email = e.target.email.value;
          const password = e.target.password.value;

          // Procura se existe um usuário com este email e senha
          const foundUser = registeredUsers.find(
            (user) => user.email === email && user.password === password
          );

          if (foundUser) {
            // Sucesso
            loginMessage.textContent = "Login realizado com sucesso! Redirecionando...";
            loginMessage.classList.remove("text-red-500");
            loginMessage.classList.add("text-green-500");

            // Salva estado de login (sessão)
            localStorage.setItem("isLoggedIn", "true");
            localStorage.setItem("loggedInUserEmail", email);

            // Redirecionamento (simulado após 1 segundo)
            setTimeout(() => {
              // window.location.href = "area_do_usuario.html";
              console.log("Redirecionaria para área logada.");
            }, 1000);
          } else {
            // Erro
            loginMessage.textContent = "E-mail ou senha incorretos. Tente novamente ou cadastre-se.";
            loginMessage.classList.remove("text-green-500");
            loginMessage.classList.add("text-red-500");
          }
        });

        // --- LÓGICA DE CADASTRO (Usando LocalStorage) ---
        document.getElementById("register").addEventListener("submit", (e) => {
          e.preventDefault();
          registerMessage.textContent = "";

          const registeredUsers = JSON.parse(localStorage.getItem("registeredUsers")) || [];
          const name = e.target.name.value;
          const email = e.target.email.value;
          const password = e.target.password.value;

          // Verifica se o email já existe
          if (registeredUsers.some((user) => user.email === email)) {
            registerMessage.textContent = "Este e-mail já está cadastrado. Tente fazer o login.";
            registerMessage.classList.remove("text-green-500");
            registerMessage.classList.add("text-red-500");
            return;
          }

          // Adiciona novo usuário na lista
          registeredUsers.push({ name, email, password });
          // Salva a lista atualizada no LocalStorage
          localStorage.setItem("registeredUsers", JSON.stringify(registeredUsers));

          registerMessage.textContent = "Cadastro realizado com sucesso! Você já pode fazer o login.";
          registerMessage.classList.remove("text-red-500");
          registerMessage.classList.add("text-green-500");

          e.target.reset(); // Limpa os campos do formulário
        });

        // --- LÓGICA DE RECUPERAÇÃO DE SENHA (Simulação) ---
        document.getElementById("forgot-password").addEventListener("submit", async (e) => {
            e.preventDefault();
            forgotMessage.textContent = "";
            forgotMessage.classList.remove("message-success", "message-error");

            const form = e.target;
            const emailToRecover = form.elements["forgot-email"].value;
            const submitButton = form.querySelector('button[type="submit"]');

            // Feedback visual: desabilita botão e muda texto
            submitButton.disabled = true;
            submitButton.textContent = "Enviando...";

            // Simula tempo de espera de servidor (1.5 segundos)
            setTimeout(() => {
              const registeredUsers = JSON.parse(localStorage.getItem("registeredUsers")) || [];
              const userExists = registeredUsers.some((user) => user.email === emailToRecover);
              let result;

              if (userExists) {
                result = {
                  success: true,
                  message: `Link de redefinição enviado para: ${emailToRecover}. (Simulado)`,
                };
              } else {
                result = {
                  success: false,
                  message: `E-mail "${emailToRecover}" não encontrado em nosso sistema.`,
                };
              }

              // Exibe a mensagem final
              if (result.success) {
                forgotMessage.textContent = result.message;
                forgotMessage.classList.add("message-success");
                forgotMessage.classList.remove("message-error");
              } else {
                forgotMessage.textContent = result.message;
                forgotMessage.classList.add("message-error");
                forgotMessage.classList.remove("message-success");
              }

              // Reabilita o botão
              submitButton.disabled = false;
              submitButton.textContent = "Enviar E-mail de Recuperação";
              form.reset();
            }, 1500);
          });
      });
    </script>

    <!-- SCRIPT 2: Configuração e Lógica do Firebase (Módulo ES) -->
    <script type="module">
      /**
       * Importação das funções do Firebase via CDN (necessário para funcionar no navegador sem bundlers).
       * Usamos a versão 10.8.0 das bibliotecas 'app' e 'auth'.
       */
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

      // Configuração do Firebase (Dados fornecidos por você)
      const firebaseConfig = {
        apiKey: "AIzaSyDziPLMJCBlAQ_AMfljLWNWh9Xu9bjl9qU",
        authDomain: "copains-5d19c.firebaseapp.com",
        projectId: "copains-5d19c",
        storageBucket: "copains-5d19c.firebasestorage.app",
        messagingSenderId: "970103327588",
        appId: "1:970103327588:web:6c1349567bef60dd70c871",
        measurementId: "G-1718MSW05T"
      };

      // Inicializa o aplicativo Firebase
      const app = initializeApp(firebaseConfig);
      // Inicializa o serviço de Autenticação
      const auth = getAuth(app);
      // Configura o provedor de autenticação do Google
      const provider = new GoogleAuthProvider();

      /**
       * Função responsável por abrir o popup de login do Google.
       * É usada tanto no botão de Login quanto no de Cadastro.
       */
      const realizarLoginGoogle = () => {
        signInWithPopup(auth, provider)
          .then((result) => {
            // Sucesso no login
            const user = result.user;
            console.log("Usuário logado via Google:", user);
            
            // Exemplo de alerta (em produção, redirecione para outra página)
            alert("Bem-vindo, " + user.displayName + "!");
            
            // Exemplo de redirecionamento:
            // window.location.href = "area_do_usuario.html";
          })
          .catch((error) => {
            // Tratamento de erro
            console.error("Erro ao logar com Google:", error);
            alert("Ops! Algo deu errado no login com Google: " + error.message);
          });
      };

      // Seleciona os botões do Google no HTML
      const btnLoginGoogle = document.getElementById('google-login-btn');
      const btnRegisterGoogle = document.getElementById('google-register-btn');
      
      // Adiciona o evento de clique aos botões se eles existirem na página
      if (btnLoginGoogle) {
        btnLoginGoogle.addEventListener('click', realizarLoginGoogle);
      }
      
      if (btnRegisterGoogle) {
        btnRegisterGoogle.addEventListener('click', realizarLoginGoogle);
      }
    </script>
  </body>
</html>